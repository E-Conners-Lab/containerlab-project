! main-agg1 - Phase 8: VRFs and L3VPN
! VRFs: STUDENT, STAFF, SERVERS
! Subinterfaces on Gi4 (to main-edge1)

vrf definition STUDENT
 rd 65001:100
 !
 address-family ipv4
  route-target export 65001:100
  route-target import 65001:100
 exit-address-family

vrf definition STAFF
 rd 65001:200
 !
 address-family ipv4
  route-target export 65001:200
  route-target import 65001:200
 exit-address-family

vrf definition SERVERS
 rd 65001:300
 !
 address-family ipv4
  route-target export 65001:300
  route-target import 65001:300
 exit-address-family

interface GigabitEthernet4.100
 description STUDENT VRF to main-edge1
 encapsulation dot1Q 100
 vrf forwarding STUDENT
 ip address 10.100.1.1 255.255.255.252
 no shutdown

interface GigabitEthernet4.200
 description STAFF VRF to main-edge1
 encapsulation dot1Q 200
 vrf forwarding STAFF
 ip address 10.200.1.1 255.255.255.252
 no shutdown

interface GigabitEthernet4.300
 description SERVERS VRF to main-edge1
 encapsulation dot1Q 300
 vrf forwarding SERVERS
 ip address 10.30.1.1 255.255.255.252
 no shutdown

router bgp 65001
 !
 address-family ipv4 vrf STUDENT
  redistribute connected
 exit-address-family
 !
 address-family ipv4 vrf STAFF
  redistribute connected
 exit-address-family
 !
 address-family ipv4 vrf SERVERS
  redistribute connected
 exit-address-family
